

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Rank Spatially Correlated Gene Clusters &mdash; Giotto 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme_edits.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/design-style.d53ab927f7bad3eaa42da95908504b10.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme_edits.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/design-tabs.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Load HMRF" href="loadHMRF.html" />
    <link rel="prev" title="Rank Spatially Correlated Gene Clusters" href="rankSpatialCorGroups.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/GiottoLogo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">General</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#giotto-object">Giotto Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#giotto-environment">Giotto Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#import-raw-data">Import Raw Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#add-images">Add Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#giotto-instructions">Giotto Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#giotto-helper-functions">Giotto Helper Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#giotto-processing-functions">Giotto Processing Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#dimension-reduction">Dimension Reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#clustering">Clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#marker-genes">Marker Genes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#auxiliary-visualizations">Auxiliary Visualizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#spatial">Spatial</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../documentation.html#hidden-markov-random-field-hmrf">Hidden Markov Random Field (HMRF)</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">doHMRF</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#arguments">Arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#value">Value</a></li>
<li class="toctree-l4"><a class="reference internal" href="#details">Details</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="loadHMRF.html">loadHMRF</a></li>
<li class="toctree-l3"><a class="reference internal" href="viewHMRFresults.html">viewHMRFresults</a></li>
<li class="toctree-l3"><a class="reference internal" href="writeHMRFresults.html">writeHMRFresults</a></li>
<li class="toctree-l3"><a class="reference internal" href="addHMRF.html">addHMRF</a></li>
<li class="toctree-l3"><a class="reference internal" href="viewHMRFresults2D.html">viewHMRFresults2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="viewHMRFresults3D.html">viewHMRFresults3D</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#d-visualization">2D Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#id1">3D Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#in-silico-cross-sections">In Silico Cross Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#cell-neighborhood">Cell Neighborhood</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#export-from-giotto-analyzer-to-viewer">Export From Giotto Analyzer To Viewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#interoperability">Interoperability</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference external" href="http://spatial.rc.fas.harvard.edu/giotto-viewer/">Giotto Viewer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../WorkflowAndHowTos.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasets.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trygiotto.html">Try Giotto</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Issues</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../errorsfaqsandtips.html">Common Errors and Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../github_issues.html">Report a Bug</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Giotto</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../documentation.html">Function Documentation</a> &raquo;</li>
        
      <li>Rank Spatially Correlated Gene Clusters</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/subsections/documentation_functions/doHMRF.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rank-spatially-correlated-gene-clusters">
<span id="dohmrf"></span><h1>Rank Spatially Correlated Gene Clusters<a class="headerlink" href="#rank-spatially-correlated-gene-clusters" title="Permalink to this headline">Â¶</a></h1>
<dl class="describe">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">doHMRF()</span></span></dt>
<dd></dd></dl>

<p><em>Rank spatial correlated clusters according to correlation structure.</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">doHMRF</span><span class="p">(</span>
        <span class="n">gobject</span><span class="p">,</span>
        <span class="n">expression_values</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">&quot;normalized&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;custom&quot;</span><span class="p">),</span>
        <span class="n">spatial_network_name</span> <span class="o">=</span> <span class="s2">&quot;Delaunay_network&quot;</span><span class="p">,</span>
        <span class="n">spatial_genes</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span>
        <span class="n">spatial_dimensions</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">&quot;sdimx&quot;</span><span class="p">,</span> <span class="s2">&quot;sdimy&quot;</span><span class="p">,</span> <span class="s2">&quot;sdimz&quot;</span><span class="p">),</span>
        <span class="n">dim_reduction_to_use</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span>
        <span class="n">dim_reduction_name</span> <span class="o">=</span> <span class="s2">&quot;pca&quot;</span><span class="p">,</span>
        <span class="n">dimensions_to_use</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">betas</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">,</span>
        <span class="n">zscore</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;rowcol&quot;</span><span class="p">,</span> <span class="s2">&quot;colrow&quot;</span><span class="p">),</span>
        <span class="n">numinit</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">python_path</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span>
        <span class="n">output_folder</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span>
        <span class="n">overwrite_output</span> <span class="o">=</span> <span class="n">TRUE</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="section" id="arguments">
<h2>Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">Â¶</a></h2>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>gobject</strong></p></td>
<td><p>giotto object</p></td>
</tr>
<tr class="row-even"><td><p><strong>expression_values</strong></p></td>
<td><p>expression values to use</p></td>
</tr>
<tr class="row-odd"><td><p><strong>spatial_network_name</strong></p></td>
<td><p>name of spatial network to use for HMRF</p></td>
</tr>
<tr class="row-even"><td><p><strong>spatial_genes</strong></p></td>
<td><p>spatial genes to use for HMRF</p></td>
</tr>
<tr class="row-odd"><td><p><strong>spatial_dimensions</strong></p></td>
<td><p>select spatial dimensions to use, default is all possible dimensions</p></td>
</tr>
<tr class="row-even"><td><p><strong>dim_reduction_to_use</strong></p></td>
<td><p>use another dimension reduction set as input</p></td>
</tr>
<tr class="row-odd"><td><p><strong>dim_reduction_name</strong></p></td>
<td><p>name of dimension reduction set to use</p></td>
</tr>
<tr class="row-even"><td><p><strong>dimensions_to_use</strong></p></td>
<td><p>number of dimensions to use as input</p></td>
</tr>
<tr class="row-odd"><td><p><strong>seed</strong></p></td>
<td><p>seed to fix random number generator (for creating initialization of HMRF) (-1 if no fixing)</p></td>
</tr>
<tr class="row-even"><td><p><strong>name</strong></p></td>
<td><p>name of HMRF run</p></td>
</tr>
<tr class="row-odd"><td><p><strong>k</strong></p></td>
<td><p>number of HMRF domains</p></td>
</tr>
<tr class="row-even"><td><p><strong>betas</strong></p></td>
<td><p>betas to test for. three numbers: start_beta, beta_increment, num_betas e.g. c(0, 2.0, 50)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>tolerance</strong></p></td>
<td><p>tolerance</p></td>
</tr>
<tr class="row-even"><td><p><strong>zscore</strong></p></td>
<td><p>zscore</p></td>
</tr>
<tr class="row-odd"><td><p><strong>numinit</strong></p></td>
<td><p>number of initializations</p></td>
</tr>
<tr class="row-even"><td><p><strong>python_path</strong></p></td>
<td><p>python path to use</p></td>
</tr>
<tr class="row-odd"><td><p><strong>output_folder</strong></p></td>
<td><p>output folder to save results</p></td>
</tr>
<tr class="row-even"><td><p><strong>overwrite_output</strong></p></td>
<td><p>overwrite output folder</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="value">
<h2>Value<a class="headerlink" href="#value" title="Permalink to this headline">Â¶</a></h2>
<p>Creates a directory with results that can be viewed with <a class="reference external" href="viewHMRFresults">viewHMRFresults()</a>.</p>
<p>Returns a list type object with the following fields:</p>
<ul class="simple">
<li><p>name: name used</p></li>
<li><p>output_data: output path</p></li>
<li><p>k: k used,</p></li>
<li><p>betas: betas used,</p></li>
<li><p>python_path: python_path_used</p></li>
</ul>
</div>
<div class="section" id="details">
<h2>Details<a class="headerlink" href="#details" title="Permalink to this headline">Â¶</a></h2>
<p>Previously we have published a paper that describes the hidden markov random field (HMRF) method for identifying spatial patterns from spatial gene expression data.
Unlike typical clustering techniques, HMRF integrates both spatial locations and the gene expression to find groups of cells that are both spatially adjacent and which are similar to each other in expression space.</p>
<p>A general guideline for choosing k is to use the gap-statistics by Tibshrani. The elbow point of the gap size vs. k plot usually indicates choices of k.
To decide which beta one should use, the current state of algorithm repeats HMRF for a number of betas. Here are some guidelines:</p>
<ul class="simple">
<li><p>if the number of genes is from 10 to 50, the recommended range is 0 to 10 at increment of 0.5. E.g. c(0,0.5,20)</p></li>
<li><p>if the number of genes is below 50, the recommended range is 0 to 15 at increment of 1. E.g. c(0,1,15)</p></li>
<li><p>if the number of genes is between 50 to 100, the range is 0 to 50 at increment of 2. E.g. c(0, 2, 25)</p></li>
<li><p>if the number of genes is between 100 and 500, the range is 0 to 100 at increment of 5. E.g. c(0, 5, 20)</p></li>
</ul>
<p>Within the range of beta, we recommend selecting the best beta by the Bayes information criterion.
This requires first performing randomization of spatial positions to generate the null distribution of log-likelihood scores for randomly distributed cells for the same range of betas.
Then find the beta where the difference between the observed and the null log-likelihood is maximized. See the HMRF tutorial from the Chapter.</p>
<p>After running HMRF, one can further view the HMRF spatial clusters (viewHMRFresults2D), and add HMRF annotation to pDataDT table (addHMRF).</p>
<p>The main steps are:</p>
<ol class="arabic simple">
<li><p>Create neighborhood network based on spatial positions</p></li>
<li><p>Define genes of interest</p></li>
<li><p>Call HMRF routine to find spatial clusters</p></li>
</ol>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#from seqfish+ dataset</span>
<span class="c1">#100 spatial genes</span>
<span class="n">HMRF_spatial_genes</span> <span class="o">=</span> <span class="n">doHMRF</span><span class="p">(</span><span class="n">gobject</span> <span class="o">=</span> <span class="n">VC_test</span><span class="p">,</span> <span class="n">expression_values</span> <span class="o">=</span> <span class="s1">&#39;scaled&#39;</span><span class="p">,</span> <span class="n">spatial_genes</span> <span class="o">=</span> <span class="n">my_spatial_genes</span><span class="p">,</span> <span class="n">spatial_network_name</span> <span class="o">=</span> <span class="s1">&#39;Delaunay_network&#39;</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">betas</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span> <span class="n">output_folder</span> <span class="o">=</span> <span class="n">paste0</span><span class="p">(</span><span class="n">hmrf_folder</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;Spatial_genes/SG_top100_k9_scaled&#39;</span><span class="p">))</span>
<span class="c1">## view results of HMRF</span>
<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
<span class="n">viewHMRFresults2D</span><span class="p">(</span><span class="n">gobject</span> <span class="o">=</span> <span class="n">VC_test</span><span class="p">,</span><span class="n">HMRFoutput</span> <span class="o">=</span> <span class="n">HMRF_spatial_genes</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">betas_to_view</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span><span class="n">point_size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">## add HMRF of interest to giotto object</span>
<span class="n">VC_test</span> <span class="o">=</span> <span class="n">addHMRF</span><span class="p">(</span><span class="n">gobject</span> <span class="o">=</span> <span class="n">VC_test</span><span class="p">,</span><span class="n">HMRFoutput</span> <span class="o">=</span> <span class="n">HMRF_spatial_genes</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">betas_to_add</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">28</span><span class="p">),</span> <span class="n">hmrf_name</span> <span class="o">=</span> <span class="s1">&#39;HMRF_2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="loadHMRF.html" class="btn btn-neutral float-right" title="Load HMRF" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="rankSpatialCorGroups.html" class="btn btn-neutral float-left" title="Rank Spatially Correlated Gene Clusters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Ruben Dries, Qian Zhu, Huipeng Li, Rui Dong, Guo-Cheng Yuan.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>